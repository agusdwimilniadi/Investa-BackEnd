name : "running unit test, build docker image, push ec2"
on :
  push:
    branches:
      - "7_Deploy"
jobs :
  unit-test:
    name: "unit test"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name : setup go
        uses: actions/setup-go@v2
        with:
          go-version: 1.17.2
      - name : running unit-test
        run: go test ./... -cover
  build-push-docker:
    name : "build image and push registry to dockerhub"
    runs-on: ubuntu-latest
    steps:
      - uses : actions/checkout@v2
      - name : build image
        run : docker build -t agusdwimilniadi/investa_backend .
      - name: login
        uses: docker/login-action@v1
        with:
          username: ${{ SECRETS.DOCKERHUB_USERNAME }}
          password: ${{ SECRETS.DOCKERHUB_PASSWORD }}
      - name: push image to dockerhub
        run: docker push agusdwimilniadi/investa_backend:latest